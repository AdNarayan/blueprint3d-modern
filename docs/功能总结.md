# Blueprint3D Next.js 应用功能总结

## 项目概述

Blueprint3D 是一个基于 Three.js 的 3D 室内设计应用，允许用户创建平面图并设计室内空间。本文档总结了 Next.js 版本（`app/` 目录）的现有功能。

## 技术栈

- **框架**: Next.js 16 (App Router) + React 19
- **语言**: TypeScript 5.9
- **3D 引擎**: Three.js r181
- **样式**: Tailwind CSS 4.0
- **UI 组件**: Radix UI + shadcn/ui
- **国际化**: next-intl
- **构建工具**: Turbopack

## 核心功能模块

### 1. 2D 平面图编辑器

**位置**: `app/components/Blueprint3DApp.tsx` + `src/floorplanner/`

**功能**:
- 三种编辑模式:
  - **移动模式**: 移动墙角和墙壁
  - **绘制模式**: 创建新墙壁
  - **删除模式**: 删除墙壁和墙角
- 实时渲染 2D 平面图
- 半边数据结构管理墙壁连接
- 自动计算房间区域

**控制组件**: `FloorplannerControls.tsx`

### 2. 3D 实时可视化

**位置**: `src/three/main.ts`

**功能**:
- Three.js 场景渲染
- 实时 3D 预览
- 光照和阴影系统
- 相机控制（OrbitControls）
- 物品交互（选择、移动、旋转）

**控制组件**: `CameraControls.tsx`

### 3. 物品管理系统

**位置**: `app/components/ItemsList.tsx`

**功能**:
- 30+ 家具物品库
- 物品分类:
  - 地板物品（桌子、椅子、沙发等）
  - 墙面物品（画框、架子等）
  - 墙内物品（门、窗等）
- 拖放添加物品
- 删除选中物品
- 物品属性编辑

**物品类型**:
```
- 开门、闭门
- 窗户
- 桌子（方形、圆形）
- 椅子
- 沙发
- 书架
- 床
- 地毯
- 等等...
```

### 4. 纹理系统

**位置**: `app/components/TextureSelector.tsx`

**功能**:
- 墙面纹理选择
- 地板纹理选择
- 纹理预览
- 纹理缩放控制
- 内置纹理库

**纹理类型**:
- 墙面纹理（砖墙、木板等）
- 地板纹理（木地板、瓷砖、地毯等）

### 5. 项目管理

**位置**: `app/components/MainControls.tsx`

**功能**:
- 新建项目
- 保存项目（本地 + 云存储）
- 加载项目（从云存储）
- 删除项目
- 导出设计为图片

**存储格式**: JSON (包含 floorplan 和 items 数据)

### 6. 国际化支持

**位置**: `app/[locale]/` + `messages/`

**支持语言**:
- English (en)
- 简体中文 (zh-CN)
- 繁体中文 (zh-TW)

**翻译文件**:
- `messages/en.json`
- `messages/zh-CN.json`
- `messages/zh-TW.json`

**切换方式**: 设置面板中的语言选择器

### 7. 用户界面

**主要组件**:

#### Sidebar (`Sidebar.tsx`)
- 可折叠侧边栏
- 标签页导航:
  - 物品 (Items)
  - 纹理 (Textures)
- 响应式布局

#### MainControls (`MainControls.tsx`)
- 顶部工具栏
- 2D/3D 视图切换
- 新建、保存、加载、删除按钮
- 设置按钮

#### FloorplannerControls (`FloorplannerControls.tsx`)
- 平面图编辑工具栏
- 模式切换按钮
- 仅在 2D 模式下显示

#### CameraControls (`CameraControls.tsx`)
- 3D 相机控制工具栏
- 缩放按钮
- 视角重置
- 仅在 3D 模式下显示

#### ContextMenu (`ContextMenu.tsx`)
- 右键菜单
- 删除物品功能

#### Settings Modal (`Settings.tsx`)
- 语言切换
- 单位切换（英寸/米/厘米/毫米）
- 其他偏好设置

### 8. 3D 交互

**功能**:
- 轨道相机控制（旋转、缩放、平移）
- 物品选择（点击）
- 物品移动（拖拽）
- 物品旋转
- 碰撞检测
- 墙壁和地板点击事件

### 9. 数据持久化

**本地存储**:
- localStorage 用于用户偏好
- 项目数据缓存

**云存储集成**:
- RESTful API 端点
- 保存/加载/删除操作
- 错误处理和重试机制

### 10. 错误处理

**功能**:
- 网络错误恢复
- 加载失败提示
- 优雅降级
- 用户友好的错误消息

## 应用架构

### 组件层级

```
Blueprint3DApp (主容器)
├── MainControls (顶部工具栏)
├── Sidebar (侧边栏)
│   ├── ItemsList (物品列表)
│   └── TextureSelector (纹理选择器)
├── FloorplannerControls (2D 编辑工具)
├── CameraControls (3D 相机工具)
├── ContextMenu (右键菜单)
└── Settings (设置面板)
```

### 状态管理

**主要状态** (9 个 useState hooks):
- `currentMode`: 当前模式 (floorplan/design)
- `blueprint3d`: Blueprint3D 实例引用
- `floorplanner`: Floorplanner 实例引用
- `three`: Three 实例引用
- `selectedItem`: 当前选中的物品
- `contextMenu`: 右键菜单状态
- `isClient`: 客户端渲染标志
- `showSettings`: 设置面板显示状态
- `showDeleteConfirm`: 删除确认对话框状态

### 事件系统

**事件回调**:
- `itemSelectedCallbacks`: 物品选择事件
- `itemLoadedCallbacks`: 物品加载完成
- `wallClicked`: 墙壁点击事件
- `floorClicked`: 地板点击事件
- `updated_rooms`: 房间更新事件

## 资源文件

### 3D 模型
**位置**: `app/public/models/`

**格式**: JSON (自定义格式，使用 JSONLoader)

**物品数量**: 30+

### 纹理图片
**位置**: `app/public/rooms/textures/`

**格式**: PNG/JPG

**类型**:
- 墙面纹理
- 地板纹理

### 配置文件
**位置**: `app/public/constants/`

**文件**:
- 默认配置
- 示例场景配置

## 开发命令

```bash
# 开发服务器
pnpm dev:nextjs       # 启动在 localhost:3000

# 生产构建
pnpm build:nextjs     # 构建优化版本
pnpm start:nextjs     # 启动生产服务器
```

## 性能特性

- **代码分割**: Next.js 自动代码分割
- **懒加载**: 动态导入组件
- **SSR 兼容**: 客户端组件标记为 'use client'
- **优化渲染**: React 19 性能改进
- **Turbopack**: 快速开发构建

## 浏览器兼容性

- 支持现代浏览器（Chrome, Firefox, Safari, Edge）
- 需要 WebGL 支持
- 推荐使用最新版本浏览器以获得最佳性能

## 未来扩展点

根据代码结构，以下是潜在的扩展方向：

1. **更多物品类型**: 扩展物品库
2. **自定义材质**: 允许用户上传自己的纹理
3. **导出格式**: 支持更多导出格式（PDF, DWG 等）
4. **协作功能**: 多用户实时编辑
5. **VR 支持**: 虚拟现实浏览模式
6. **AI 辅助**: 智能布局建议
7. **移动端优化**: 触摸控制优化

## 文档更新

- **创建日期**: 2025-11-27
- **版本**: v1.0
- **维护者**: Blueprint3D 团队

---

如需更详细的技术文档，请参考：
- `/docs/` - 其他文档
- `CLAUDE.md` - 项目架构说明
- `README.md` - 项目介绍
